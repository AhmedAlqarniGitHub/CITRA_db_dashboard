import{j as e,y as ye,X as q,N as b,P as n,r as u,T as O,M as B,Y as we,O as Re,S as Ee,Z as Ie,$ as te,W as Te}from"./index-68cf636a.js";import{M as ke,a as E,O as qe,C as Oe,F as K,I as ne,S as ae,b as Pe}from"./axios-9c6a5e82.js";import{e as Ne,T as I,a as o,f as Ae,L as $e,D as ce,b as de,c as he,d as ue,g as se,h as ze,i as Le,j as Fe,k as We}from"./label-a76510e7.js";import{C as Q}from"./Checkbox-9fd7f520.js";import{T as C,I as _e}from"./TextField-53147780.js";import{D as Me}from"./DialogContentText-e7983820.js";import{B as L}from"./Button-71f483d7.js";import{C as Ue}from"./Container-c2567aed.js";import{C as He}from"./CircularProgress-12514937.js";import{R as Be,a as ie}from"./RadioGroup-59df9906.js";const Ve={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function ge({order:a,orderBy:i,rowCount:s,headLabel:d,numSelected:g,onRequestSort:r,onSelectAllClick:x}){const p=h=>P=>{r(P,h)};return e.jsx(Ne,{children:e.jsxs(I,{children:[e.jsx(o,{padding:"checkbox",children:e.jsx(Q,{indeterminate:g>0&&g<s,checked:s>0&&g===s,onChange:x})}),d.map(h=>e.jsx(o,{align:h.align||"left",sortDirection:i===h.id?a:!1,style:{width:h.width},children:e.jsxs(Ae,{active:i===h.id,direction:i===h.id?a:"asc",onClick:p(h.id),hideSortIcon:!h.disableSorting,children:[h.label,i===h.id?e.jsx(ye,{component:"span",sx:Ve,children:a==="desc"?"sorted descending":"sorted ascending"}):null]})},h.id)),e.jsx(o,{children:e.jsx(q,{disabled:!0,children:e.jsx(b,{icon:"eva:more-vertical-fill",width:"24",height:"24"})})})]})})}ge.propTypes={order:n.oneOf(["asc","desc"]).isRequired,orderBy:n.string.isRequired,rowCount:n.number.isRequired,headLabel:n.arrayOf(n.shape({id:n.string.isRequired,label:n.string.isRequired,align:n.string,width:n.string,minWidth:n.number,disableSorting:n.bool})).isRequired,numSelected:n.number.isRequired,onRequestSort:n.func.isRequired,onSelectAllClick:n.func.isRequired};const re={}.VITE_API_URL||"http://localhost:3000",le=a=>{const i={year:"numeric",month:"long",day:"numeric"};return new Date(a).toLocaleDateString(void 0,i)};function xe({eventId:a,organizer:i,eventName:s,description:d,startDate:g,endDate:r,status:x,location:p,selected:h,handleClick:P,refreshEventList:S}){const[N,T]=u.useState(null),[F,y]=u.useState(!1),[m,v]=u.useState({eventName:s,description:d,startDate:g,endDate:r,location:p,organizer:i}),V=!!N,G=j=>{T(j.currentTarget)},k=()=>{T(null)},X=()=>{v({eventName:s,description:d,startDate:g.split("T")[0],endDate:r.split("T")[0],location:p,organizer:i}),y(!0),k()},Y=()=>{y(!1),v({eventName:s,description:d,startDate:g,endDate:r,location:p,organizer:i})},w=j=>f=>{v({...m,[j]:f.target.value})},Z=async()=>{const j={name:m.eventName,description:m.description,startingDate:new Date(m.startDate).toISOString(),endingDate:new Date(m.endDate).toISOString(),location:m.location,organizer:m.organizer};try{let f={id:localStorage.getItem("id")};const U=await E.patch(`${re}/events/update/${a}/${f.id}`,j);S(),y(!1)}catch(f){console.error("Error saving edited data:",f),f.response&&f.response.data.errors&&f.response.data.errors.forEach(U=>{console.error(U.message)})}},[W,l]=u.useState(!1),A=()=>{l(!0),k()},_=async()=>{try{let j={id:localStorage.getItem("id")};const f=await E.delete(`${re}/events/${a}/${j.id}`);S()}catch(j){console.error("Error deleting event:",j)}l(!1)},M=()=>{l(!1)};return e.jsxs(I,{hover:!0,tabIndex:-1,selected:h,children:[e.jsx(o,{padding:"checkbox",children:e.jsx(Q,{checked:h,onChange:j=>P(j,id)})}),F?e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(C,{value:m.eventName,onChange:w("eventName"),size:"small",fullWidth:!0,variant:"outlined"})}),e.jsx(o,{children:e.jsx(C,{value:m.description,onChange:w("description"),size:"small",fullWidth:!0,variant:"outlined"})}),e.jsx(o,{children:e.jsx(C,{type:"date",value:m.startDate,onChange:w("startDate"),size:"small",fullWidth:!0,variant:"outlined"})}),e.jsx(o,{children:e.jsx(C,{type:"date",value:m.endDate,onChange:w("endDate"),size:"small",fullWidth:!0,variant:"outlined"})}),e.jsx(o,{children:e.jsx(C,{value:m.location,onChange:w("location"),size:"small",fullWidth:!0,variant:"outlined"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(O,{variant:"subtitle2",noWrap:!0,sx:{fontWeight:"bold"},children:s})}),"          ",e.jsx(o,{children:d}),e.jsx(o,{children:le(g)}),e.jsx(o,{children:le(r)}),e.jsx(o,{children:p})]}),e.jsx(o,{children:e.jsx($e,{color:x==="Active"?"success":"error",children:x})}),e.jsx(o,{align:"right",children:F?e.jsxs(e.Fragment,{children:[e.jsx(q,{onClick:Z,color:"primary",children:e.jsx(b,{icon:"eva:checkmark-circle-2-outline",width:"24",height:"24"})}),e.jsx(q,{onClick:Y,color:"secondary",children:e.jsx(b,{icon:"eva:close-circle-outline",width:"24",height:"24"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{onClick:G,children:e.jsx(b,{icon:"eva:more-vertical-fill",width:"24",height:"24"})}),e.jsxs(ke,{anchorEl:N,open:V,onClose:k,children:[e.jsxs(B,{onClick:X,children:[e.jsx(b,{icon:"eva:edit-fill",width:"24",height:"24"}),"Edit"]}),window.localStorage.getItem("role")=="admin"?e.jsxs(B,{onClick:A,children:[e.jsx(b,{icon:"eva:trash-2-outline",width:"24",height:"24"}),"Delete"]}):null]})]})}),e.jsxs(ce,{open:W,onClose:M,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(de,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(he,{children:e.jsx(Me,{id:"alert-dialog-description",children:"Are you sure you want to delete this event?"})}),e.jsxs(ue,{children:[e.jsx(L,{onClick:M,children:"Cancel"}),e.jsx(L,{onClick:_,color:"primary",children:"Delete"})]})]})]})}xe.propTypes={eventName:n.string.isRequired,eventId:n.string.isRequired,description:n.string,startDate:n.string,endDate:n.string,status:n.string,location:n.string,selected:n.bool.isRequired,handleClick:n.func.isRequired,refreshEventList:n.func.isRequired};function me({numSelected:a,filterName:i,onFilterName:s}){return e.jsxs(we,{sx:{height:96,display:"flex",justifyContent:"space-between",p:d=>d.spacing(0,1,0,3),...a>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[a>0?e.jsxs(O,{component:"div",variant:"subtitle1",children:[a," selected"]}):e.jsx(qe,{value:i,onChange:s,placeholder:"Search event...",startAdornment:e.jsx(_e,{position:"start",children:e.jsx(b,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})}),a>0?e.jsx(se,{title:"Delete",children:e.jsx(q,{children:e.jsx(b,{icon:"eva:trash-2-fill"})})}):e.jsx(se,{title:"Filter list",children:e.jsx(q,{children:e.jsx(b,{icon:"ic:round-filter-list"})})})]})}me.propTypes={numSelected:n.number.isRequired,filterName:n.string.isRequired,onFilterName:n.func.isRequired};function pe({query:a}){return e.jsx(I,{children:e.jsx(o,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(Re,{sx:{textAlign:"center"},children:[e.jsx(O,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(O,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',a,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}pe.propTypes={query:n.string};n.bool.isRequired,n.string.isRequired,n.string.isRequired,n.string.isRequired,n.string.isRequired,n.string.isRequired,n.string.isRequired,n.func.isRequired;function oe(a,i,s){return i[s]===null?1:a[s]===null||i[s]<a[s]?-1:i[s]>a[s]?1:0}function Ge(a,i){return a==="desc"?(s,d)=>oe(s,d,i):(s,d)=>-oe(s,d,i)}function Xe({inputData:a,comparator:i,filterName:s}){const d=a.map((r,x)=>[r,x]);d.sort((r,x)=>{const p=i(r[0],x[0]);return p!==0?p:r[1]-x[1]});let g=d.map(r=>r[0]);return s&&(g=g.filter(r=>r.name?r.name.toLowerCase().indexOf(s.toLowerCase())!==-1:"")),g}const z={}.VITE_API_URL||"http://localhost:3000";function Ye(){const[a,i]=u.useState([]),[s,d]=u.useState(!0),[g,r]=u.useState(""),[x,p]=u.useState(0),[h,P]=u.useState("asc"),[S,N]=u.useState([]),[T,F]=u.useState("eventName"),[y,m]=u.useState(""),[v,V]=u.useState(5),[G,k]=u.useState(!1),[X,Y]=u.useState([]),[w,Z]=u.useState([]),W={organizer:"",eventName:"",description:"",startDate:"",endDate:"",location:"",status:"active",cameras:[]},[l,A]=u.useState(W);u.useEffect(()=>{let t={id:localStorage.getItem("id")};E.get(`${z}/events/all/${t.id}`).then(c=>{i(c.data),r("")}).catch(c=>{r(c.message)}).finally(()=>{d(!1)}),j()},[]);const _=async()=>{try{d(!0);let t={id:localStorage.getItem("id")};const c=await E.get(`${z}/events/all/${t.id}`);i(c.data),r("")}catch(t){r(t.message)}finally{d(!1)}},M=async()=>{try{const t=localStorage.getItem("id"),c=await E.get(`${z}/cameras/available/${t}`);Y(c.data)}catch(t){console.error("Error fetching available cameras:",t)}},j=async()=>{try{const t=await E.get(`${z}/users/all/${localStorage.getItem("id")}`);Z(t.data)}catch(t){console.error("Error fetching organizers:",t)}},f=(t,c)=>{P(T===c&&h==="asc"?"desc":"asc"),F(c)},U=t=>{m(t.target.value),p(0)},je=(t,c)=>{p(c)},ve=t=>{V(parseInt(t.target.value,10)),p(0)},fe=t=>{N(t.target.checked?a.map(c=>c._id):[])},be=t=>{let R=S.indexOf(t)===-1?[...S,t]:S.filter($=>$!==t);N(R)},H=Xe({inputData:a,comparator:Ge(h,T),filterName:y}),Ce=()=>{M(),A(W),k(!0)},J=()=>{k(!1)},Se=localStorage.getItem("themeMode")==="dark",D=t=>{const{name:c,value:R}=t.target;A(c==="cameras"?$=>({...$,[c]:typeof R=="string"?R.split(","):R}):$=>({...$,[c]:R}))},De=async()=>{try{const t={name:l.eventName,location:l.location,startingDate:new Date(l.startDate).toISOString(),endingDate:new Date(l.endDate).toISOString(),description:l.description,organizer:l.organizer,status:l.status,cameras:l.cameras},c=await E.post(`${z}/events/register`,t);J(),_()}catch(t){console.error("There was an error submitting the form",t)}},ee=v-Math.min(v,H.length-x*v);return e.jsxs(e.Fragment,{children:[e.jsxs(Ue,{children:[e.jsxs(Ee,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(O,{variant:"h4",children:"Events"}),window.localStorage.getItem("role")=="admin"?e.jsx(L,{variant:"contained",color:"inherit",startIcon:e.jsx(b,{icon:"eva:plus-fill"}),onClick:Ce,children:"New Event"}):null]}),e.jsxs(Oe,{children:[e.jsx(me,{numSelected:S.length,filterName:y,onFilterName:U}),e.jsx(Ie,{children:e.jsx(ze,{sx:{overflow:"unset"},children:e.jsxs(Le,{sx:{minWidth:800},children:[e.jsx(ge,{order:h,orderBy:T,rowCount:a.length,numSelected:S.length,onRequestSort:f,onSelectAllClick:fe,headLabel:[{id:"eventName",label:"Event Name",align:"left"},{id:"description",label:"Description",align:"left"},{id:"startDate",label:"Start Date",align:"left"},{id:"endDate",label:"End Date",align:"left"},{id:"location",label:"Location",align:"left"},{id:"status",label:"Status",align:"left"}]}),e.jsxs(Fe,{children:[s?e.jsx(I,{children:e.jsx(o,{colSpan:6,align:"center",children:e.jsx(He,{})})}):g?e.jsx(I,{children:e.jsx(o,{colSpan:6,align:"center",children:e.jsx(O,{variant:"subtitle1",color:"error",children:g})})}):H.length>0?H.slice(x*v,x*v+v).map(t=>e.jsx(xe,{eventName:t.name,organizer:t.organizer,eventId:t._id,description:t.description,startDate:t.startingDate,endDate:t.endingDate,status:t.status.charAt(0).toUpperCase()+t.status.slice(1),location:t.location,selected:S.includes(t._id),handleClick:()=>be(t._id),refreshEventList:_},t._id)):e.jsx(I,{children:e.jsx(o,{colSpan:6,align:"center",children:e.jsx(pe,{query:y})})}),ee>0&&e.jsx(I,{style:{height:53*ee},children:e.jsx(o,{colSpan:6})})]})]})})}),e.jsx(We,{rowsPerPageOptions:[5,10,25],component:"div",count:H.length,rowsPerPage:v,page:x,onPageChange:je,onRowsPerPageChange:ve})]})]}),e.jsxs(ce,{open:G,onClose:J,sx:{"& .MuiDialog-paper":{boxShadow:Se?"none":void 0}},children:[e.jsx(de,{children:"Add New Event"}),e.jsxs(he,{children:[e.jsx(C,{margin:"dense",name:"eventName",label:"Event Name",type:"text",fullWidth:!0,variant:"outlined",value:l.eventName,onChange:D}),e.jsx(C,{margin:"dense",name:"description",label:"Description",type:"text",fullWidth:!0,variant:"outlined",multiline:!0,rows:4,value:l.description,onChange:D}),e.jsx(C,{margin:"dense",name:"startDate",label:"Start Date",type:"datetime-local",fullWidth:!0,variant:"outlined",InputLabelProps:{shrink:!0},value:l.startDate,onChange:D}),e.jsx(C,{margin:"dense",name:"endDate",label:"End Date",type:"datetime-local",fullWidth:!0,variant:"outlined",InputLabelProps:{shrink:!0},value:l.endDate,onChange:D}),e.jsx(C,{margin:"dense",name:"location",label:"Location",type:"text",fullWidth:!0,variant:"outlined",value:l.location,onChange:D}),e.jsxs(K,{fullWidth:!0,margin:"dense",children:[e.jsx(ne,{children:"Organizer"}),e.jsx(ae,{name:"organizer",value:l.organizer,onChange:D,label:"Organizer",children:w.map(t=>e.jsx(B,{value:t._id,children:t.name},t._id))})]}),e.jsxs(K,{fullWidth:!0,margin:"dense",children:[e.jsx(ne,{children:"Available Cameras"}),e.jsx(ae,{multiple:!0,name:"cameras",label:"Available Cameras",value:l.cameras,onChange:D,renderValue:t=>t.join(", "),children:X.map(t=>e.jsxs(B,{value:t._id,children:[e.jsx(Q,{checked:l.cameras.indexOf(t._id)>-1}),`${t.manufacturer} ${t.model}`]},t._id))})]}),e.jsxs(K,{component:"fieldset",margin:"dense",children:[e.jsx(Pe,{component:"legend",children:"Status"}),e.jsxs(Be,{row:!0,name:"status",value:l.status,onChange:D,children:[e.jsx(te,{value:"active",control:e.jsx(ie,{}),label:"Active"}),e.jsx(te,{value:"inactive",control:e.jsx(ie,{}),label:"Inactive"})]})]})]}),e.jsxs(ue,{children:[e.jsx(L,{onClick:J,children:"Cancel"}),e.jsx(L,{onClick:De,children:"Submit"})]})]})]})}function rt(){return e.jsxs(e.Fragment,{children:[e.jsxs(Te,{children:[e.jsx("title",{children:"Event | CITRA Dashboard"})," "]}),e.jsx(Ye,{})," "]})}export{rt as default};
